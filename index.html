<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ’° Controle Financeiro</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="mainApp" class="app">
    <!-- SCREEN: LOGIN -->
    <div id="loginScreen" class="screen active">
      <div class="auth-container">
        <div class="auth-box">
          <h1>ğŸ’° Controle Financeiro</h1>
          <p>Gerencie suas finanÃ§as com facilidade</p>
          
          <div class="form-group">
            <input type="email" id="loginEmail" placeholder="Email" class="input">
          </div>
          
          <div class="form-group">
            <input type="password" id="loginPassword" placeholder="Senha" class="input">
          </div>
          
          <button class="btn btn--primary btn--block" onclick="handleLogin()">Entrar</button>
          
          <p class="auth-toggle">
            NÃ£o tem conta? <a href="#" onclick="showSignup(); return false;">Cadastre-se</a>
          </p>
        </div>
      </div>
    </div>

    <!-- SCREEN: SIGNUP -->
    <div id="signupScreen" class="screen">
      <div class="auth-container">
        <div class="auth-box">
          <h1>ğŸ’° Controle Financeiro</h1>
          <p>Crie sua conta</p>
          
          <div class="form-group">
            <input type="email" id="signupEmail" placeholder="Email" class="input">
          </div>
          
          <div class="form-group">
            <input type="password" id="signupPassword" placeholder="Senha (mÃ­n. 6 caracteres)" class="input">
          </div>
          
          <button class="btn btn--primary btn--block" onclick="handleSignup()">Cadastrar</button>
          
          <p class="auth-toggle">
            JÃ¡ tem conta? <a href="#" onclick="showLogin(); return false;">Entrar</a>
          </p>
        </div>
      </div>
    </div>

    <!-- SCREEN: MAIN APP -->
    <div id="mainScreen" class="screen">
      <!-- HEADER -->
      <header class="app-header">
        <h1>ğŸ’° Controle Financeiro</h1>
        <div style="display: flex; gap: 12px; align-items: center;">
          <button class="btn btn--primary" onclick="reloadNow()" title="Atualizar dados">ğŸ”„ Atualizar</button>
          <button class="btn btn--secondary" onclick="handleLogout()">ğŸšª Sair</button>
        </div>
      </header>

      <!-- NAVIGATION -->
      <nav class="app-nav">
        <button class="nav-item active" data-view="dashboard" onclick="showView('dashboard')">ğŸ“Š Dashboard</button>
        <button class="nav-item" data-view="transactions" onclick="showView('transactions')">ğŸ’³ TransaÃ§Ãµes</button>
        <button class="nav-item" data-view="accounts" onclick="showView('accounts')">ğŸ¦ Contas</button>
        <button class="nav-item" data-view="credit-cards" onclick="showView('credit-cards')">ğŸ’° CartÃµes</button>
        <button class="nav-item" data-view="categories" onclick="showView('categories')">ğŸ“‚ Categorias</button>
        <button class="nav-item" data-view="investments" onclick="showView('investments')">ğŸ“ˆ Investimentos</button>
      </nav>

      <!-- VIEWS -->
      <main class="app-main">
        <!-- DASHBOARD VIEW -->
        <div id="dashboardView" class="view active">
          <div class="view-header">
            <h2>ğŸ“Š Dashboard</h2>
          </div>

          <!-- Cards de PatrimÃ´nio -->
          <div class="dashboard-grid">
            <div class="dashboard-card">
              <div class="card-label">PatrimÃ´nio LÃ­quido</div>
              <div class="card-value" id="netWorthValue">R$ 0,00</div>
            </div>
            <div class="dashboard-card">
              <div class="card-label">Saldo em Contas</div>
              <div class="card-value" id="totalAccountsValue">R$ 0,00</div>
            </div>
            <div class="dashboard-card">
              <div class="card-label">Total Investido</div>
              <div class="card-value" id="totalInvestedValue">R$ 0,00</div>
            </div>
            <div class="dashboard-card">
              <div class="card-label">CartÃµes a Pagar</div>
              <div class="card-value" id="totalCardsDebtValue">R$ 0,00</div>
            </div>
          </div>

          <!-- Receitas e Despesas do MÃªs -->
          <div class="section">
            <h3>ğŸ“… Receitas e Despesas - Este MÃªs</h3>
            <div class="dashboard-grid">
              <div class="dashboard-card success">
                <div class="card-label">Receitas</div>
                <div class="card-value" id="monthIncomeValue">R$ 0,00</div>
              </div>
              <div class="dashboard-card danger">
                <div class="card-label">Despesas</div>
                <div class="card-value" id="monthExpenseValue">R$ 0,00</div>
              </div>
              <div class="dashboard-card">
                <div class="card-label">Saldo</div>
                <div class="card-value" id="monthBalanceValue">R$ 0,00</div>
              </div>
            </div>
          </div>

          <!-- Total do Ano -->
          <div class="section">
            <h3>ğŸ“Š Total do Ano (2025)</h3>
            <div class="dashboard-grid">
              <div class="dashboard-card success">
                <div class="card-label">Receitas</div>
                <div class="card-value" id="yearIncomeValue">R$ 0,00</div>
              </div>
              <div class="dashboard-card danger">
                <div class="card-label">Despesas</div>
                <div class="card-value" id="yearExpenseValue">R$ 0,00</div>
              </div>
              <div class="dashboard-card">
                <div class="card-label">Saldo</div>
                <div class="card-value" id="yearBalanceValue">R$ 0,00</div>
              </div>
            </div>
          </div>

          <!-- Comparativo com 2024 -->
          <div class="section">
            <h3>ğŸ“ˆ Comparativo com 2024</h3>
            <div class="dashboard-grid">
              <div class="dashboard-card">
                <div class="card-label">Receitas 2024</div>
                <div class="card-value" id="lastYearIncomeValue">R$ 0,00</div>
              </div>
              <div class="dashboard-card">
                <div class="card-label">VariaÃ§Ã£o Receitas</div>
                <div class="card-value" id="incomeVariation">0%</div>
              </div>
              <div class="dashboard-card">
                <div class="card-label">Despesas 2024</div>
                <div class="card-value" id="lastYearExpenseValue">R$ 0,00</div>
              </div>
              <div class="dashboard-card">
                <div class="card-label">VariaÃ§Ã£o Despesas</div>
                <div class="card-value" id="expenseVariation">0%</div>
              </div>
            </div>
          </div>

          <!-- Insights -->
          <div class="section">
            <h3>ğŸ’¡ Insights</h3>
            <div class="dashboard-grid">
              <div class="dashboard-card">
                <div class="card-label">Categoria Mais Gasta</div>
                <div class="card-value" id="topCategoryName">-</div>
                <div class="card-secondary" id="topCategoryValue">R$ 0,00</div>
              </div>
              <div class="dashboard-card">
                <div class="card-label">MÃ©dia de Gastos (6M)</div>
                <div class="card-value" id="avgMonthExpenseValue">R$ 0,00</div>
              </div>
            </div>
          </div>
        </div>

        <!-- TRANSACTIONS VIEW -->
        <div id="transactionsView" class="view">
          <div class="view-header">
            <h2>ğŸ’³ TransaÃ§Ãµes</h2>
            <button class="btn btn--primary" onclick="showAddTransactionModal()">â• Nova TransaÃ§Ã£o</button>
          </div>

          <!-- FILTROS (MantÃ©m formato antigo funcional) -->
          <div class="filters-section">
            <div class="filters-header">
              <h3>ğŸ” Filtros</h3>
              <button class="btn btn--secondary" onclick="filterTransactions(); clearDateFilter();" style="font-size: 12px; padding: 6px 12px;">
                â†º Limpar
              </button>
            </div>

            <!-- Linha 1: Tipo, Conta, Categoria -->
            <div class="filters-row">
              <div>
                <label>ğŸ“‹ Tipo</label>
                <select id="transactionTypeFilter" onchange="filterTransactions()">
                  <option value="all">Todos os Tipos</option>
                  <option value="income">ğŸ“¥ Receitas</option>
                  <option value="expense">ğŸ“¤ Despesas</option>
                  <option value="transfer">â‡„ TransferÃªncias</option>
                </select>
              </div>

              <div>
                <label>ğŸ¦ Conta</label>
                <select id="transactionAccountFilter" onchange="filterTransactions()">
                  <option value="all">Todas as Contas</option>
                </select>
              </div>

              <div>
                <label>ğŸ“‚ Categoria</label>
                <select id="transactionCategoryFilter" onchange="filterTransactions()">
                  <option value="all">Todas as Categorias</option>
                </select>
              </div>
            </div>

            <!-- Linha 2: Atalhos de Data -->
            <div class="filters-row" style="padding-top: 12px; border-top: 1px solid #eee;">
              <button class="btn btn--small" onclick="filterThisMonth()" style="padding: 6px 12px; font-size: 12px;">
                ğŸ“… Este mÃªs
              </button>
              <button class="btn btn--small" onclick="filterLastMonth()" style="padding: 6px 12px; font-size: 12px;">
                ğŸ“… MÃªs passado
              </button>
              <button class="btn btn--small" onclick="filterThisYear()" style="padding: 6px 12px; font-size: 12px;">
                ğŸ“… Este ano
              </button>
              <button class="btn btn--small" onclick="filterLast30Days()" style="padding: 6px 12px; font-size: 12px;">
                ğŸ“… Ãšltimos 30 dias
              </button>
              <button class="btn btn--small" onclick="filterLast7Days()" style="padding: 6px 12px; font-size: 12px;">
                ğŸ“… Ãšltimos 7 dias
              </button>
            </div>
          </div>

          <!-- Totalizadores -->
          <div class="totals-row">
            <div class="total-card">
              <span>Receitas</span>
              <strong id="totalIncome">R$ 0,00</strong>
            </div>
            <div class="total-card danger">
              <span>Despesas</span>
              <strong id="totalExpense">R$ 0,00</strong>
            </div>
            <div class="total-card">
              <span>Saldo</span>
              <strong id="totalBalance">R$ 0,00</strong>
            </div>
          </div>

          <!-- Lista de TransaÃ§Ãµes -->
          <div id="transactionsList" class="transactions-list">
          </div>
        </div>

        <!-- ACCOUNTS VIEW -->
        <div id="accountsView" class="view">
          <div class="view-header">
            <h2>ğŸ¦ Contas</h2>
            <button class="btn btn--primary" onclick="showAddAccountModal()">â• Nova Conta</button>
          </div>
          <div id="accountsList" class="accounts-grid">
          </div>
        </div>

        <!-- CREDIT CARDS VIEW -->
        <div id="creditCardsView" class="view">
          <div class="view-header">
            <h2>ğŸ’° CartÃµes de CrÃ©dito</h2>
            <button class="btn btn--primary" onclick="showAddCreditCardModal()">â• Novo CartÃ£o</button>
          </div>
          <div id="creditCardsGrid" class="credit-cards-grid">
          </div>
        </div>

        <!-- CATEGORIES VIEW -->
        <div id="categoriesView" class="view">
          <div class="view-header">
            <h2>ğŸ“‚ Categorias</h2>
            <button class="btn btn--primary" onclick="showAddCategoryModal()">â• Nova Categoria</button>
          </div>
          <div id="categoriesList" class="categories-list">
          </div>
        </div>

        <!-- INVESTMENTS VIEW -->
        <div id="investmentsView" class="view">
          <div class="view-header">
            <h2>ğŸ“ˆ Investimentos</h2>
            <button class="btn btn--primary" onclick="showAddInvestmentModal()">â• Novo Investimento</button>
          </div>

          <div class="investments-summary">
            <div class="summary-card">
              <div>Total Investido</div>
              <div class="summary-value" id="invTotalInvested">R$ 0,00</div>
            </div>
            <div class="summary-card">
              <div>Valor Atual</div>
              <div class="summary-value" id="invCurrentValue">R$ 0,00</div>
            </div>
            <div class="summary-card">
              <div>Total Retorno</div>
              <div class="summary-value" id="invTotalReturn">R$ 0,00</div>
            </div>
            <div class="summary-card">
              <div>Retorno %</div>
              <div class="summary-value" id="invReturnPercent">0%</div>
            </div>
          </div>

          <div>
            <label>Filtrar por Tipo:</label>
            <select id="investmentTypeFilter" onchange="filterInvestments()">
              <option value="all">Todos</option>
              <option value="stocks">AÃ§Ãµes</option>
              <option value="bonds">TÃ­tulos</option>
              <option value="funds">Fundos</option>
              <option value="crypto">Criptomoedas</option>
              <option value="real_estate">ImÃ³veis</option>
              <option value="other">Outros</option>
            </select>
          </div>

          <div id="investmentsList" class="investments-grid">
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- MODALS -->
  <!-- Transaction Modal -->
  <div id="transactionModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>â• Nova TransaÃ§Ã£o</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Data</label>
          <input type="date" id="transactionDate" class="input">
        </div>

        <div class="form-group">
          <label>Tipo</label>
          <select id="transactionType" onchange="updateTransactionForm()" class="input">
            <option value="expense">Despesa</option>
            <option value="income">Receita</option>
            <option value="transfer">TransferÃªncia</option>
          </select>
        </div>

        <div class="form-group">
          <label>Valor</label>
          <input type="number" id="transactionAmount" placeholder="0.00" step="0.01" class="input">
        </div>

        <div class="form-group">
          <label>DescriÃ§Ã£o</label>
          <input type="text" id="transactionDescription" class="input">
        </div>

        <div class="form-group">
          <label>Conta</label>
          <select id="transactionAccount" class="input">
          </select>
        </div>

        <div id="transactionCategoryField" class="form-group">
          <label>Categoria</label>
          <select id="transactionCategory" class="input">
          </select>
        </div>

        <div id="transactionTransferField" class="form-group" style="display: none;">
          <label>Transferir para</label>
          <select id="transactionTransferTo" class="input">
          </select>
        </div>

        <button class="btn btn--primary btn--block" onclick="saveTransaction()">ğŸ’¾ Salvar TransaÃ§Ã£o</button>
      </div>
    </div>
  </div>

  <!-- Account Modal -->
  <div id="accountModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>â• Nova Conta</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Nome</label>
          <input type="text" id="accountName" class="input">
        </div>
        <div class="form-group">
          <label>Tipo</label>
          <select id="accountType" class="input">
            <option value="checking">Corrente</option>
            <option value="savings">PoupanÃ§a</option>
            <option value="cash">Dinheiro</option>
            <option value="other">Outra</option>
          </select>
        </div>
        <div class="form-group">
          <label>Saldo Inicial</label>
          <input type="number" id="accountBalance" placeholder="0.00" step="0.01" class="input">
        </div>
        <button class="btn btn--primary btn--block" onclick="saveAccount()">ğŸ’¾ Salvar</button>
      </div>
    </div>
  </div>

  <!-- Credit Card Modal -->
  <div id="creditCardModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>ğŸ’³ Novo CartÃ£o</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Banco</label>
          <input type="text" id="creditCardBank" class="input">
        </div>
        <div class="form-group">
          <label>Bandeira</label>
          <select id="creditCardNetwork" class="input">
            <option>Visa</option>
            <option>Mastercard</option>
            <option>Elo</option>
            <option>Amex</option>
          </select>
        </div>
        <div class="form-group">
          <label>Ãšltimos 4 DÃ­gitos</label>
          <input type="text" id="creditCardDigits" placeholder="0000" class="input">
        </div>
        <div class="form-group">
          <label>Titular</label>
          <input type="text" id="creditCardHolder" class="input">
        </div>
        <div class="form-group">
          <label>Limite</label>
          <input type="number" id="creditCardLimit" placeholder="0.00" step="0.01" class="input">
        </div>
        <div class="form-group">
          <label>Dia do Vencimento</label>
          <input type="number" id="creditCardClosingDay" min="1" max="31" value="15">
        </div>
        <div class="form-group">
          <label>Dia de Vencimento do Pagamento</label>
          <input type="number" id="creditCardDueDay" min="1" max="31" value="25">
        </div>
        <div class="form-group">
          <label>Conta Associada</label>
          <select id="creditCardAccount" class="input">
          </select>
        </div>
        <div class="form-group">
          <label>ObservaÃ§Ãµes</label>
          <textarea id="creditCardNotes" class="input" rows="3"></textarea>
        </div>
        <button class="btn btn--primary btn--block" onclick="saveCreditCard()">ğŸ’¾ Salvar</button>
      </div>
    </div>
  </div>

  <!-- Category Modal -->
  <div id="categoryModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>ğŸ“‚ Nova Categoria</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Nome</label>
          <input type="text" id="categoryName" class="input">
        </div>
        <div class="form-group">
          <label>Tipo</label>
          <select id="categoryType" class="input">
            <option value="expense">Despesa</option>
            <option value="income">Receita</option>
          </select>
        </div>
        <div class="form-group">
          <label>AlocaÃ§Ã£o PrimÃ¡ria %</label>
          <input type="number" id="categoryPrimary" min="0" max="100">
        </div>
        <div class="form-group">
          <label>AlocaÃ§Ã£o SecundÃ¡ria %</label>
          <input type="number" id="categorySecondary" min="0" max="100">
        </div>
        <div class="form-group">
          <label>Cor</label>
          <input type="color" id="categoryColor" value="#3B82F6">
        </div>
        <button class="btn btn--primary btn--block" onclick="saveCategory()">ğŸ’¾ Salvar</button>
      </div>
    </div>
  </div>

  <!-- Investment Modal -->
  <div id="investmentModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>ğŸ“ˆ Novo Investimento</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Nome</label>
          <input type="text" id="investmentName" class="input">
        </div>
        <div class="form-group">
          <label>Tipo</label>
          <select id="investmentType" class="input">
            <option value="stocks">AÃ§Ãµes</option>
            <option value="bonds">TÃ­tulos</option>
            <option value="funds">Fundos</option>
            <option value="crypto">Criptomoedas</option>
            <option value="real_estate">ImÃ³veis</option>
            <option value="other">Outro</option>
          </select>
        </div>
        <div class="form-group">
          <label>InstituiÃ§Ã£o</label>
          <input type="text" id="investmentInstitution" class="input">
        </div>
        <div class="form-group">
          <label>Data de Compra</label>
          <input type="date" id="investmentPurchaseDate" class="input">
        </div>
        <div class="form-group">
          <label>Valor Inicial</label>
          <input type="number" id="investmentInitialAmount" placeholder="0.00" step="0.01" class="input">
        </div>
        <div class="form-group">
          <label>Valor Atual</label>
          <input type="number" id="investmentCurrentValue" placeholder="0.00" step="0.01" class="input">
        </div>
        <div class="form-group">
          <label>Data de Vencimento</label>
          <input type="date" id="investmentMaturityDate" class="input">
        </div>
        <div class="form-group">
          <label>Notas</label>
          <textarea id="investmentNotes" class="input" rows="3"></textarea>
        </div>
        <button class="btn btn--primary btn--block" onclick="saveInvestment()">ğŸ’¾ Salvar</button>
      </div>
    </div>
  </div>

  <!-- Payment Card Modal -->
  <div id="payCardModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>ğŸ’³ Pagar CartÃ£o</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div id="payCardInfo"></div>
        <div class="form-group">
          <label>Valor</label>
          <input type="number" id="payCardAmount" placeholder="0.00" step="0.01" class="input">
        </div>
        <div class="form-group">
          <label>Data</label>
          <input type="date" id="payCardDate" class="input">
        </div>
        <div class="form-group">
          <label>De qual conta?</label>
          <select id="payCardFromAccount" class="input">
          </select>
        </div>
        <button class="btn btn--primary btn--block" onclick="processCardPayment()">ğŸ’³ Confirmar Pagamento</button>
      </div>
    </div>
  </div>

  <!-- Card Detail Modal -->
  <div id="creditCardDetailModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="cardDetailTitle">Detalhes do CartÃ£o</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div id="cardDetailContent"></div>
      </div>
    </div>
  </div>

  <!-- Investment Detail Modal -->
  <div id="investmentDetailModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>ğŸ“ˆ Detalhes do Investimento</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <p><strong>Nome:</strong> <span id="invDetailName"></span></p>
        <p><strong>Tipo:</strong> <span id="invDetailType"></span></p>
        <p><strong>InstituiÃ§Ã£o:</strong> <span id="invDetailInstitution"></span></p>
        <p><strong>Total Investido:</strong> <span id="invDetailTotalInvested"></span></p>
        <p><strong>Valor Atual:</strong> <span id="invDetailCurrentValue"></span></p>
        <p><strong>Retorno:</strong> <span id="invDetailReturn"></span> (<span id="invDetailReturnPercent"></span>%)</p>
        
        <hr>
        
        <button class="btn btn--secondary btn--block" onclick="showAddInvestmentTransactionModal()">â• Adicionar TransaÃ§Ã£o</button>
      </div>
    </div>
  </div>

  <!-- Investment Transaction Modal -->
  <div id="investmentTransactionModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>â• TransaÃ§Ã£o de Investimento</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Tipo</label>
          <select id="invTransactionType" class="input">
            <option value="contribution">Aporte</option>
            <option value="withdrawal">Resgate</option>
            <option value="yield">Rendimento</option>
            <option value="dividend">Dividendo</option>
          </select>
        </div>
        <div class="form-group">
          <label>Valor</label>
          <input type="number" id="invTransactionAmount" placeholder="0.00" step="0.01" class="input">
        </div>
        <div class="form-group">
          <label>Data</label>
          <input type="date" id="invTransactionDate" class="input">
        </div>
        <div class="form-group">
          <label>DescriÃ§Ã£o</label>
          <input type="text" id="invTransactionDescription" class="input">
        </div>
        <div class="form-group">
          <label>Conta</label>
          <select id="invTransactionAccount" class="input">
          </select>
        </div>
        <button class="btn btn--primary btn--block" onclick="saveInvestmentTransaction()">ğŸ’¾ Salvar</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="app.js"></script>
</body>
</html>
